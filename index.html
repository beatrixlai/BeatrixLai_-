<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨æ–¹ä½æˆ€æ„›é‹å‹¢ç«™ï¼šæœˆè€ãƒ»å¡”ç¾…ãƒ»éˆæ•¸</title>
    
    <!-- 1. å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. å¼•å…¥ React å’Œ Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. è‡ªå®šç¾©å‹•ç•«æ¨£å¼ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap');
        
        body { font-family: 'Helvetica Neue', Arial, 'Noto Serif TC', sans-serif; }
        
        /* æ–æ™ƒå‹•ç•« */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shake-animation { animation: shake 0.5s infinite; }
        
        /* ç¿»ç‰Œå‹•ç•« */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }

        /* é›·é”æ³¢ç´‹å‹•ç•« */
        @keyframes ping-slow {
            75%, 100% { transform: scale(2); opacity: 0; }
        }
        .animate-ping-slow { animation: ping-slow 2s cubic-bezier(0, 0, 0.2, 1) infinite; }
    </style>
</head>
<body class="bg-stone-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 0. åœ–ç¤ºåº« (SVG) ---
        const Icons = {
            Zap: () => <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            RotateCcw: () => <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Scissors: () => <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>,
            Heart: () => <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
            Compass: () => <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>,
            MapPin: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            Sparkles: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>,
            Cards: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="6" y="2" width="12" height="20" rx="2"></rect><line x1="6" y1="12" x2="18" y2="12"></line></svg>,
            Hash: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line></svg>,
            Navigation: () => <svg className="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>,
            Locate: () => <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>,
            Scroll: () => <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M8 17.5a5 5 0 0 1 2.5-9 2.5 2.5 0 0 1 2.5 9 5 5 0 0 0 2.5 9 2.5 2.5 0 0 0 2.5-9"/><path d="M19 17.5a2.5 2.5 0 0 0-5 0"/><path d="M10 2.5a2.5 2.5 0 0 0-5 0v15a2.5 2.5 0 0 0 5 0Z"/></svg>
        };

        // --- 1. è³‡æ–™åº« (æ–°å¢ lat, lng åº§æ¨™) ---
        const TEMPLE_DATA = [
            { 
                id: 1, title: "æ±‚æ­£ç·£", subtitle: "å–®èº«æƒ³å©šã€éœ€è¦æ¨éŠ·", icon: <Icons.Zap className="text-red-600"/>, color: "bg-red-50", borderColor: "border-red-200", 
                temples: [
                    { name: "å°åŒ—éœæµ·åŸéšå»Ÿ", tag: "æ•ˆç‡ç‹", desc: "ä¸æ±‚ç±¤ã€å¿«ç‹ æº–", lat: 25.0556, lng: 121.5100 }, 
                    { name: "å°å—å¤§è§€éŸ³äº­", tag: "é—Šå˜´æœˆè€", desc: "æœˆè€å–„èªªåª’", lat: 22.9982, lng: 120.2030 }, 
                    { name: "é«˜é›„é—œå¸å»Ÿ", tag: "ç²¾æº–é…å°", desc: "å¡«ç–æ–‡åƒéå±¥æ­·", lat: 22.6288, lng: 120.3340 }, 
                    { name: "å®œè˜­å››çµç¦å¾·å»Ÿ", tag: "æœ€å¤§é‡‘èº«", desc: "æ•²ç´…é¸å¿ƒå‹•é˜", lat: 24.6974, lng: 121.7745 }
                ] 
            },
            { 
                id: 2, title: "æ±‚å¾©åˆ", subtitle: "åˆ†æ‰‹æŒ½å›ã€åµæ¶å’Œå¥½", icon: <Icons.RotateCcw className="text-blue-600"/>, color: "bg-blue-50", borderColor: "border-blue-200", 
                temples: [
                    { name: "å°ä¸­æ¨‚æˆå®®", tag: "å¾©åˆè–åœ°", desc: "ç±¤è©©åˆ†é¡è¶…ç´°è†©", lat: 24.1368, lng: 120.6973 }, 
                    { name: "å°å—é‡æ…¶å¯º", tag: "æ”ªé†‹çŸ¸", desc: "é€†æ™‚é˜æ”ªé†‹èƒ½å›é ­", lat: 22.9912, lng: 120.2036 }
                ] 
            },
            { 
                id: 3, title: "æ–¬çˆ›æ¡ƒèŠ±", subtitle: "é‡äººä¸æ·‘ã€æ–·é–‹å­½ç·£", icon: <Icons.Scissors className="text-gray-700"/>, color: "bg-gray-100", borderColor: "border-gray-300", 
                temples: [
                    { name: "å°å—ç¥€å…¸æ­¦å»Ÿ", tag: "æ‹æ–æœˆè€", desc: "æ‰“è·‘æ¸£ç”·å°ä¸‰", lat: 22.9964, lng: 120.2030 }, 
                    { name: "è‰‹èˆºé¾å±±å¯º", tag: "åš´æ ¼å¯©æ ¸", desc: "ä¸‰æ¬¡è–ç­Šæ‰çµ¦ç·š", lat: 25.0371, lng: 121.4999 }
                ] 
            },
            { 
                id: 4, title: "æ„Ÿæƒ…åŠ æº«", subtitle: "çªç ´æ›–æ˜§ã€ç¥ˆæ±‚ç©©å®š", icon: <Icons.Heart className="text-pink-500"/>, color: "bg-pink-50", borderColor: "border-pink-200", 
                temples: [
                    { name: "å°å—å¤§å¤©åå®®", tag: "ç·£ç²‰åŠ æŒ", desc: "é»è‡‰é °å¢é­…åŠ›", lat: 22.9962, lng: 120.2018 }, 
                    { name: "é¹¿æ¸¯å¤©åå®®", tag: "é©åˆæƒ…ä¾¶", desc: "é©åˆæƒ…ä¾¶æ±‚ç©©å®š", lat: 24.0569, lng: 120.4346 }
                ] 
            },
            { 
                id: 5, title: "æŒ‡é»è¿·æ´¥", subtitle: "ä¸çŸ¥æ–¹å‘ã€é©ä¸é©åˆ", icon: <Icons.Compass className="text-purple-600"/>, color: "bg-purple-50", borderColor: "border-purple-200", 
                temples: [
                    { name: "æ—¥æœˆæ½­é¾é³³å®®", tag: "ç¥æº–ç±¤è©©", desc: "ä¸€é‡è¦‹è¡€è§£è¿·æƒ˜", lat: 23.8710, lng: 120.9080 }, 
                    { name: "æ¿æ©‹æ…ˆæƒ å®®", tag: "å…¨æ–¹ä½", desc: "æ„Ÿæƒ…å·¥ä½œä¸€èµ·å•", lat: 25.0089, lng: 121.4578 }
                ] 
            }
        ];

        const FORTUNE_STICKS = [
            { label: "å¤§å‰", title: "ç´…é¸æ˜Ÿå‹•", text: "ä»Šæ—¥é­…åŠ›çˆ†æ£šï¼Œè½‰è§’é‡åˆ°æ„›çš„æ©Ÿç‡æ¥µé«˜ï¼", color: "text-red-600", bg: "bg-red-50" },
            { label: "ä¸Šå‰", title: "å¿ƒæœ‰éˆçŠ€", text: "è©¦è‘—ä¸»å‹•å‚³å€‹è¨Šæ¯ï¼Œæœƒæœ‰æ„æƒ³ä¸åˆ°çš„ç”œèœœå›æ‡‰ã€‚", color: "text-pink-600", bg: "bg-pink-50" },
            { label: "ä¸­å‰", title: "æ›–æ˜§å‡æº«", text: "è‹¥å³è‹¥é›¢çš„è·é›¢æœ€ç¾ï¼Œä¿æŒç¥ç§˜æ„Ÿè®“å°æ–¹å¥½å¥‡ã€‚", color: "text-purple-600", bg: "bg-purple-50" },
            { label: "å°å‰", title: "å¹³æ·¡æ˜¯ç¦", text: "åˆ¥å¤ªæ€¥èºï¼Œäº«å—ä¸€å€‹äººçš„è‡ªåœ¨ï¼Œç·£åˆ†æ­£åœ¨é†é‡€ä¸­ã€‚", color: "text-blue-600", bg: "bg-blue-50" },
            { label: "å¹³ç±¤", title: "æ²‰æ¾±è‡ªæˆ‘", text: "èˆ‡å…¶å‘å¤–å°‹æ±‚ï¼Œä¸å¦‚å…ˆæ„›è‡ªå·±ã€‚ä»Šæ—¥é©åˆé–±è®€é‹å‹•ã€‚", color: "text-stone-600", bg: "bg-stone-100" },
        ];

        const TAROT_CARDS = [
            { name: "æ„šè€…", image: "ğŸƒ", keywords: "æ–°çš„é–‹å§‹ã€å†’éšª", advice: "ä¸è¦å®³æ€•è¸å‡ºç¬¬ä¸€æ­¥ï¼Œæ„›æƒ…éœ€è¦ä¸€é»è¡å‹•ã€‚", reversed: false },
            { name: "æˆ€äºº", image: "ğŸ’•", keywords: "é¸æ“‡ã€å’Œè«§", advice: "å‚¾è½å…§å¿ƒçš„è²éŸ³ï¼Œé€™æ˜¯ä¸€æ®µå€¼å¾—æŠ•å…¥çš„é—œä¿‚ã€‚", reversed: false },
            { name: "åŠ›é‡", image: "ğŸ¦", keywords: "å‹‡æ°£ã€åŒ…å®¹", advice: "ä»¥æŸ”å…‹å‰›ï¼Œå±•ç¾ä½ çš„è€å¿ƒèˆ‡æº«æŸ”ã€‚", reversed: false },
            { name: "å‘½é‹ä¹‹è¼ª", image: "ğŸ¡", keywords: "è½‰è®Šã€æ™‚æ©Ÿ", advice: "ç·£åˆ†ä¾†äº†æ“‹ä¸ä½ï¼Œé †å…¶è‡ªç„¶æ¥å—è®ŠåŒ–ã€‚", reversed: false },
            { name: "æ˜Ÿæ˜Ÿ", image: "âœ¨", keywords: "å¸Œæœ›ã€ç™‚ç™’", advice: "ä¿æŒæ¨‚è§€ï¼Œæœªä¾†çš„è—åœ–æ­£åœ¨æ…¢æ…¢å¯¦ç¾ã€‚", reversed: false },
            { name: "å¤ªé™½", image: "ğŸŒ", keywords: "å¿«æ¨‚ã€æˆåŠŸ", advice: "å±•ç¾ä½ é™½å…‰çš„ä¸€é¢ï¼Œä½ çš„ç¬‘å®¹å°±æ˜¯æœ€å¼·çš„æ­¦å™¨ã€‚", reversed: false },
        ];

        const NUMEROLOGY_DATA = {
            1: { title: "é–‹å‰µå‹", desc: "ä¸»è§€æ„è­˜å¼·ï¼Œå–œæ­¡ä¸»å°ã€‚é©åˆèƒ½æ¬£è³ä½ æ‰è¯çš„ä¼´ä¾¶ã€‚" },
            2: { title: "ä¾è³´å‹", desc: "æ•æ„Ÿç´°è†©ï¼Œé‡è¦–é™ªä¼´ã€‚éœ€è¦ä¸€å€‹èƒ½æä¾›å®‰å…¨æ„Ÿçš„å°è±¡ã€‚" },
            3: { title: "ç†æƒ³å‹", desc: "åƒå€‹å­©å­èˆ¬å……æ»¿å¥½å¥‡ã€‚æ„›æƒ…å°ä½ ä¾†èªªå¿…é ˆæ˜¯æœ‰è¶£çš„ã€‚" },
            4: { title: "ç©©å®šå‹", desc: "å‹™å¯¦è² è²¬ï¼Œè¿½æ±‚å®‰å®šã€‚å¿ èª æ˜¯ä½ æœ€å¤§çš„å„ªé»ã€‚" },
            5: { title: "è‡ªç”±å‹", desc: "ç†±æ„›è‡ªç”±ï¼Œè¨å­æŸç¸›ã€‚ä½ éœ€è¦å¿ƒéˆå¥‘åˆçš„ä¼´ä¾¶ã€‚" },
            6: { title: "å¥‰ç»å‹", desc: "éå¸¸æœ‰æ„›å¿ƒï¼Œå–œæ­¡ç…§é¡§äººã€‚ä½†è¦å°å¿ƒä¸è¦å¤±å»è‡ªæˆ‘ã€‚" },
            7: { title: "ç²¾ç¥å‹", desc: "é‡è¦–ç²¾ç¥äº¤æµã€‚ä½ éœ€è¦ä¸€å€‹æ‡‚ä½ æ²ˆé»˜ä¸”æœ‰æ™ºæ…§çš„å°è±¡ã€‚" },
            8: { title: "é ˜è¢–å‹", desc: "æ¸´æœ›æŒæ§ï¼Œå°æ„Ÿæƒ…æœ‰é‡å¿ƒã€‚é©åˆå‹¢å‡åŠ›æ•µçš„å¼·è€…ã€‚" },
            9: { title: "åšæ„›å‹", desc: "æµªæ¼«ä¸”å……æ»¿å¤¢æƒ³ã€‚ä½ éœ€è¦ä¸€å€‹èƒ½æ”¯æŒä½ ç†æƒ³çš„éˆé­‚ä¼´ä¾¶ã€‚" },
        };

        // --- 2. è¼”åŠ©å‡½å¼ ---
        // è¨ˆç®—ç”Ÿå‘½éˆæ•¸
        const calculateLifePath = (dateString) => {
            if (!dateString) return null;
            const digits = dateString.replace(/[^0-9]/g, '').split('').map(Number);
            let sum = digits.reduce((a, b) => a + b, 0);
            while (sum > 9) sum = sum.toString().split('').map(Number).reduce((a, b) => a + b, 0);
            return sum;
        };

        // è¨ˆç®—è·é›¢ (Haversine Formula)
        const calculateDistance = (lat1, lon1, lat2, lon2) => {
            const R = 6371; // åœ°çƒåŠå¾‘ (km)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return (R * c).toFixed(1); // å›å‚³å°æ•¸é»å¾Œä¸€ä½
        };

        // --- 3. ä¸»è¦æ‡‰ç”¨ç¨‹å¼ ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('temple');
            const [birthDate, setBirthDate] = useState('');
            const [lifePathNum, setLifePathNum] = useState(null);
            
            // ç‹€æ…‹å€
            const [stickFortune, setStickFortune] = useState(null);
            const [isShaking, setIsShaking] = useState(false);
            const [tarotCard, setTarotCard] = useState(null);
            const [isFlipping, setIsFlipping] = useState(false);
            
            // å®šä½åŠŸèƒ½ç‹€æ…‹
            const [userLocation, setUserLocation] = useState(null);
            const [nearestTemple, setNearestTemple] = useState(null);
            const [isLoadingLocation, setIsLoadingLocation] = useState(false);
            const [locationError, setLocationError] = useState(null);

            useEffect(() => {
                if (birthDate) {
                    setLifePathNum(calculateLifePath(birthDate));
                }
            }, [birthDate]);

            const handleStickDraw = () => {
                if (isShaking) return;
                setIsShaking(true);
                setStickFortune(null);
                setTimeout(() => {
                    setStickFortune(FORTUNE_STICKS[Math.floor(Math.random() * FORTUNE_STICKS.length)]);
                    setIsShaking(false);
                }, 800);
            };

            const handleTarotDraw = () => {
                if (isFlipping) return;
                setIsFlipping(true);
                setTarotCard(null);
                setTimeout(() => {
                    setTarotCard(TAROT_CARDS[Math.floor(Math.random() * TAROT_CARDS.length)]);
                    setIsFlipping(false);
                }, 600);
            };

            // å°‹æ‰¾æœ€è¿‘æœˆè€å»Ÿ
            const findNearest = () => {
                setIsLoadingLocation(true);
                setLocationError(null);
                
                if (!navigator.geolocation) {
                    setLocationError("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å®šä½åŠŸèƒ½");
                    setIsLoadingLocation(false);
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        setUserLocation({ lat: latitude, lng: longitude });

                        // æ‰å¹³åŒ–æ‰€æœ‰å»Ÿå®‡è³‡æ–™ä»¥ä¾¿æœå°‹
                        let allTemples = [];
                        TEMPLE_DATA.forEach(cat => {
                            cat.temples.forEach(t => {
                                allTemples.push({ ...t, categoryColor: cat.color, categoryBorder: cat.borderColor });
                            });
                        });

                        // å°‹æ‰¾æœ€çŸ­è·é›¢
                        let minInfo = { distance: Infinity, temple: null };
                        
                        allTemples.forEach(temple => {
                            const dist = parseFloat(calculateDistance(latitude, longitude, temple.lat, temple.lng));
                            if (dist < minInfo.distance) {
                                minInfo = { distance: dist, temple: temple };
                            }
                        });

                        setNearestTemple(minInfo);
                        setIsLoadingLocation(false);
                    },
                    (error) => {
                        console.error(error);
                        setLocationError("ç„¡æ³•å–å¾—æ‚¨çš„ä½ç½®ï¼Œè«‹ç¢ºèªå·²é–‹å•Ÿå®šä½æ¬Šé™");
                        setIsLoadingLocation(false);
                    }
                );
            };

            return (
                <div className="flex justify-center items-start pt-8 pb-20 px-4">
                    <div className="max-w-md w-full bg-white rounded-2xl shadow-2xl overflow-hidden border-4 border-red-800">
                        
                        {/* é ‚éƒ¨å€åŸŸ */}
                        <div className="bg-red-800 p-6 text-center relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                            <h1 className="text-2xl font-bold text-yellow-100 mb-1 tracking-wider">å…¨æ–¹ä½æˆ€æ„›é‹å‹¢</h1>
                            <div className="text-red-200 text-xs mb-4">æœˆè€ x å¡”ç¾… x ç”Ÿå‘½éˆæ•¸</div>

                            <div className="bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-red-400/30">
                                <label className="block text-red-100 text-xs mb-1 text-left">è«‹è¼¸å…¥ç”Ÿæ—¥ (è¥¿å…ƒ)ï¼š</label>
                                <div className="flex items-center gap-2">
                                    <input type="date" value={birthDate} onChange={(e) => setBirthDate(e.target.value)}
                                        className="w-full bg-white/90 text-gray-800 rounded px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400" />
                                    {lifePathNum && (
                                        <span className="bg-yellow-400 text-red-900 font-bold w-8 h-8 flex items-center justify-center rounded-full shrink-0 shadow-lg animate-bounce">
                                            {lifePathNum}
                                        </span>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* åˆ†é  Tab */}
                        <div className="flex border-b border-gray-200 bg-white sticky top-0 z-10">
                            <button onClick={() => setActiveTab('temple')} className={`flex-1 py-3 text-sm font-bold flex justify-center items-center gap-1 ${activeTab === 'temple' ? 'text-red-700 border-b-2 border-red-700 bg-red-50' : 'text-gray-400 hover:text-gray-600'}`}>
                                <Icons.MapPin className="w-4 h-4"/> æœˆè€æ”»ç•¥
                            </button>
                            <button onClick={() => setActiveTab('fortune')} className={`flex-1 py-3 text-sm font-bold flex justify-center items-center gap-1 ${activeTab === 'fortune' ? 'text-purple-700 border-b-2 border-purple-700 bg-purple-50' : 'text-gray-400 hover:text-gray-600'}`}>
                                <Icons.Cards className="w-4 h-4"/> é‹å‹¢å åœ
                            </button>
                            <button onClick={() => setActiveTab('numerology')} className={`flex-1 py-3 text-sm font-bold flex justify-center items-center gap-1 ${activeTab === 'numerology' ? 'text-blue-700 border-b-2 border-blue-700 bg-blue-50' : 'text-gray-400 hover:text-gray-600'}`}>
                                <Icons.Hash className="w-4 h-4"/> ç”Ÿå‘½éˆæ•¸
                            </button>
                        </div>

                        <div className="bg-[url('https://www.transparenttextures.com/patterns/cream-paper.png')] min-h-[400px]">
                            
                            {/* 1. æœˆè€æ”»ç•¥ (å«å®šä½åŠŸèƒ½) */}
                            {activeTab === 'temple' && (
                                <div className="p-4 space-y-4 animate-fade-in">
                                    
                                    {/* --- æ–°å¢ï¼šå®šä½æœ€è¿‘æœˆè€å€å¡Š --- */}
                                    <div className="bg-white rounded-xl shadow-md p-4 border-2 border-yellow-400 relative overflow-hidden">
                                        <div className="relative z-10 text-center">
                                            <h2 className="text-yellow-700 font-bold mb-3 flex items-center justify-center gap-2">
                                                <Icons.Locate /> å°‹æ‰¾èº«é‚Šçš„ç·£åˆ†
                                            </h2>
                                            
                                            {!nearestTemple ? (
                                                <button onClick={findNearest} disabled={isLoadingLocation}
                                                    className={`w-full py-2 rounded-full font-bold text-white shadow-md transition-all flex items-center justify-center gap-2 
                                                    ${isLoadingLocation ? 'bg-gray-400 cursor-not-allowed' : 'bg-yellow-500 hover:bg-yellow-600 active:scale-95'}`}>
                                                    {isLoadingLocation ? (
                                                        <>
                                                            <span className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
                                                            å®šä½æœå°‹ä¸­...
                                                        </>
                                                    ) : 'é»æ“Šæœå°‹ã€Œæœ€è¿‘çš„æœˆè€å»Ÿã€'}
                                                </button>
                                            ) : (
                                                <div className="animate-fade-in text-left bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <div className="text-xs text-yellow-600 font-bold mb-1">æœ€è¿‘çš„æ•‘æ˜Ÿæ˜¯ï¼š</div>
                                                            <div className="text-xl font-bold text-gray-800">{nearestTemple.temple.name}</div>
                                                        </div>
                                                        <div className="text-right">
                                                            <span className="block text-2xl font-bold text-red-600">{nearestTemple.distance}</span>
                                                            <span className="text-xs text-gray-500">å…¬é‡Œ (ç›´ç·š)</span>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="flex gap-2 mb-3">
                                                        <span className="text-xs bg-white border border-gray-200 px-2 py-0.5 rounded text-gray-600 font-medium">
                                                            {nearestTemple.temple.tag}
                                                        </span>
                                                        <span className="text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded font-bold">
                                                            {nearestTemple.temple.desc}
                                                        </span>
                                                    </div>

                                                    <a href={`https://www.google.com/maps/dir/?api=1&destination=${nearestTemple.temple.lat},${nearestTemple.temple.lng}`} 
                                                       target="_blank"
                                                       className="block w-full text-center bg-blue-600 text-white text-sm py-2 rounded hover:bg-blue-700 flex items-center justify-center gap-1">
                                                        <Icons.Navigation /> é–‹å•Ÿ Google Maps å°èˆª
                                                    </a>
                                                    
                                                    <button onClick={findNearest} className="w-full text-center text-xs text-gray-400 mt-2 underline">é‡æ–°å®šä½</button>
                                                </div>
                                            )}
                                            
                                            {locationError && <div className="text-red-500 text-xs mt-2">{locationError}</div>}
                                        </div>
                                        {/* è£é£¾èƒŒæ™¯ */}
                                        <div className="absolute -right-4 -bottom-4 text-yellow-100/50 w-24 h-24 rotate-12 pointer-events-none">
                                            <Icons.Locate />
                                        </div>
                                    </div>
                                    {/* --- çµæŸï¼šå®šä½å€å¡Š --- */}

                                    <div className="text-center text-xs text-gray-500 mb-2 mt-4">æˆ–æ˜¯ä¾ç…§éœ€æ±‚ï¼Œé¸æ“‡ä½ çš„å‘½å®šæœˆè€</div>
                                    
                                    {TEMPLE_DATA.map((cat) => (
                                        <div key={cat.id} className={`rounded-xl border ${cat.borderColor} overflow-hidden shadow-sm bg-white`}>
                                            <div className={`${cat.color} p-3 flex items-center justify-between border-b ${cat.borderColor}`}>
                                                <div className="flex items-center space-x-2">
                                                    <div className="bg-white p-1.5 rounded-full shadow-sm">{cat.icon}</div>
                                                    <div>
                                                        <h3 className="font-bold text-gray-800 text-sm">{cat.title}</h3>
                                                        <p className="text-[10px] text-gray-500">{cat.subtitle}</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="p-2 grid grid-cols-1 gap-1">
                                                {cat.temples.map((t, idx) => (
                                                    <div key={idx} className="flex justify-between items-center px-2 py-1.5 hover:bg-gray-50 rounded">
                                                        <span className="text-sm text-gray-700 font-medium">{t.name}</span>
                                                        <div className="flex flex-col items-end">
                                                            <span className="text-[10px] bg-white border border-gray-200 px-1.5 py-0.5 rounded text-gray-500 mb-0.5">{t.tag}</span>
                                                            <span className="text-[9px] text-gray-400">{t.desc}</span>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* 2. é‹å‹¢å åœé é¢ */}
                            {activeTab === 'fortune' && (
                                <div className="p-4 space-y-8 animate-fade-in">
                                    <div className="bg-white rounded-xl shadow-md p-4 border border-red-100">
                                        <h2 className="text-center font-bold text-red-800 mb-3 flex items-center justify-center gap-2">
                                            <Icons.Scroll /> æ¯æ—¥æˆ€æ„›éˆç±¤
                                        </h2>
                                        {!stickFortune ? (
                                            <button onClick={handleStickDraw} disabled={isShaking} 
                                                className={`w-full ${isShaking ? 'bg-red-400 shake-animation' : 'bg-gradient-to-r from-red-600 to-red-500'} text-white py-3 rounded-lg font-bold shadow-lg transition-all`}>
                                                {isShaking ? 'èª å¿ƒç¥ˆæ±‚ä¸­...' : 'æ–ä¸€æ–æ±‚ç±¤'}
                                            </button>
                                        ) : (
                                            <div className={`text-center p-4 rounded-lg border-2 border-dashed ${stickFortune.bg.replace('bg-', 'border-')} ${stickFortune.bg}`}>
                                                <div className={`text-2xl font-bold mb-1 ${stickFortune.color}`}>{stickFortune.label}</div>
                                                <div className="text-lg font-bold text-gray-800 mb-2">{stickFortune.title}</div>
                                                <p className="text-sm text-gray-600">{stickFortune.text}</p>
                                                <button onClick={() => setStickFortune(null)} className="mt-3 text-xs text-gray-400 underline">é‡æŠ½</button>
                                            </div>
                                        )}
                                    </div>
                                    <div className="bg-white rounded-xl shadow-md p-4 border border-purple-100">
                                        <h2 className="text-center font-bold text-purple-800 mb-3 flex items-center justify-center gap-2">
                                            <Icons.Sparkles /> ä»Šæ—¥å¡”ç¾…æŒ‡å¼•
                                        </h2>
                                        {!tarotCard ? (
                                            <div onClick={handleTarotDraw} className="cursor-pointer group perspective-1000 w-32 h-48 mx-auto relative">
                                                <div className={`w-full h-full bg-purple-600 rounded-lg shadow-xl border-4 border-white flex items-center justify-center text-white text-4xl transition-transform duration-500 ${isFlipping ? 'rotate-y-180' : ''}`}>ğŸ”®</div>
                                                <p className="text-center text-xs text-gray-400 mt-2">é»æ“Šå¡èƒŒæŠ½ç‰Œ</p>
                                            </div>
                                        ) : (
                                            <div className="text-center animate-fade-in">
                                                <div className="w-20 h-28 bg-white border-2 border-purple-200 rounded mx-auto mb-2 flex items-center justify-center text-4xl shadow-sm">{tarotCard.image}</div>
                                                <h3 className="font-bold text-lg text-gray-800">{tarotCard.name}</h3>
                                                <div className="flex justify-center gap-2 my-1">
                                                    {tarotCard.keywords.split('ã€').map(k => (
                                                        <span key={k} className="text-[10px] bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full">{k}</span>
                                                    ))}
                                                </div>
                                                <p className="text-sm text-gray-600 mt-2 bg-purple-50 p-2 rounded">{tarotCard.advice}</p>
                                                <button onClick={() => setTarotCard(null)} className="mt-2 text-xs text-gray-400 underline">é‡æŠ½</button>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* 3. ç”Ÿå‘½éˆæ•¸é é¢ */}
                            {activeTab === 'numerology' && (
                                <div className="p-6 animate-fade-in">
                                    {!birthDate ? (
                                        <div className="text-center py-10">
                                            <div className="text-6xl mb-4">ğŸ”¢</div>
                                            <h3 className="text-lg font-bold text-gray-700 mb-2">è«‹å…ˆè¼¸å…¥ç”Ÿæ—¥</h3>
                                            <p className="text-sm text-gray-500">è«‹åœ¨ä¸Šæ–¹ç´…è‰²å€å¡Šè¼¸å…¥æ‚¨çš„è¥¿å…ƒå‡ºç”Ÿå¹´æœˆæ—¥ï¼Œ<br/>æˆ‘å°‡ç‚ºæ‚¨è§£æå°ˆå±¬çš„ã€Œæˆ€æ„›æ€§æ ¼éˆæ•¸ã€ã€‚</p>
                                        </div>
                                    ) : lifePathNum ? (
                                        <div className="bg-white rounded-xl shadow-lg border-t-4 border-blue-500 overflow-hidden">
                                            <div className="bg-blue-50 p-6 text-center border-b border-blue-100">
                                                <div className="text-xs text-blue-600 font-bold tracking-widest mb-1">YOUR NUMBER</div>
                                                <div className="text-6xl font-black text-blue-600 mb-2 drop-shadow-sm">{lifePathNum}</div>
                                                <h2 className="text-xl font-bold text-gray-800">{NUMEROLOGY_DATA[lifePathNum]?.title || "ç¥ç¥•äºº"}</h2>
                                            </div>
                                            <div className="p-6">
                                                <h3 className="text-sm font-bold text-gray-400 mb-2 uppercase">Character Analysis</h3>
                                                <p className="text-gray-700 leading-relaxed text-justify">{NUMEROLOGY_DATA[lifePathNum]?.desc}</p>
                                            </div>
                                        </div>
                                    ) : null}
                                </div>
                            )}
                        </div>
                        <div className="h-2 bg-yellow-500"></div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>